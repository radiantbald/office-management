<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DFD ‚Äî Office Management System</title>
    <style>
        :root {
            --accent: #4f46e5;
            --accent-light: #818cf8;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
            --text: #1e293b;
            --text-muted: #64748b;
            --radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--accent) 0%, #7c3aed 100%);
            color: #fff;
            padding: 48px 24px 36px;
            text-align: center;
        }
        .header h1 { font-size: 2rem; font-weight: 700; margin-bottom: 6px; }
        .header p  { font-size: 1.05rem; opacity: .85; }

        /* ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ */
        .nav {
            position: sticky; top: 0; z-index: 50;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            display: flex; flex-wrap: wrap; gap: 6px;
            justify-content: center;
            padding: 12px 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,.06);
        }
        .nav button {
            padding: 8px 18px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all .2s;
        }
        .nav button:hover { border-color: var(--accent-light); color: var(--accent); }
        .nav button.active {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }

        /* ‚îÄ‚îÄ Content ‚îÄ‚îÄ */
        .content { max-width: 1200px; margin: 0 auto; padding: 32px 20px 60px; }

        .section { display: none; }
        .section.active { display: block; animation: fadeUp .35s ease; }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(12px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .section h2 {
            font-size: 1.6rem;
            margin-bottom: 8px;
            color: var(--accent);
        }
        .section > p { color: var(--text-muted); margin-bottom: 24px; }

        .diagram-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 28px 24px;
            margin-bottom: 28px;
            overflow-x: auto;
            box-shadow: 0 1px 4px rgba(0,0,0,.04);
        }
        .diagram-card h3 {
            font-size: 1.1rem; margin-bottom: 16px; color: var(--text);
        }

        .mermaid { text-align: center; }

        /* Info boxes */
        .info {
            background: #eff6ff;
            border-left: 4px solid var(--accent);
            padding: 18px 20px;
            border-radius: 0 var(--radius) var(--radius) 0;
            margin-top: 20px;
        }
        .info h4 { color: var(--accent); margin-bottom: 8px; font-size: 1rem; }
        .info ul { list-style: none; padding: 0; }
        .info li { padding: 5px 0 5px 20px; position: relative; }
        .info li::before { content: "‚Üí"; position: absolute; left: 0; color: var(--accent); font-weight: 700; }

        /* Legend */
        .legend {
            display: flex; flex-wrap: wrap; gap: 14px;
            padding: 14px 18px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-top: 16px;
        }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 13px; }
        .legend-dot {
            width: 22px; height: 22px;
            border-radius: 5px;
            border: 1px solid var(--border);
        }

        /* Tech grid */
        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        .tech-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            transition: box-shadow .2s, transform .2s;
        }
        .tech-card:hover { transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0,0,0,.08); }
        .tech-card h4 { color: var(--accent); margin-bottom: 6px; }
        .tech-card p  { color: var(--text-muted); font-size: .92rem; }
        
        footer {
            text-align: center; padding: 24px; color: var(--text-muted); font-size: .85rem;
            border-top: 1px solid var(--border);
            max-width: 1200px; margin: 0 auto;
        }

        @media (max-width: 640px) {
            .header h1 { font-size: 1.5rem; }
            .nav button { font-size: 12px; padding: 6px 12px; }
            .content { padding: 20px 12px 40px; }
        }
    </style>
    <script>
        /* ‚îÄ‚îÄ Tab switching ‚Äî must be in <head> so onclick handlers work ‚îÄ‚îÄ */
        function showTab(tabId, clickedBtn) {
            var sections = document.querySelectorAll('.section');
            var buttons  = document.querySelectorAll('#nav button');
            for (var i = 0; i < sections.length; i++) sections[i].classList.remove('active');
            for (var i = 0; i < buttons.length;  i++) buttons[i].classList.remove('active');

            var target = document.getElementById(tabId);
            if (target) target.classList.add('active');
            if (clickedBtn) clickedBtn.classList.add('active');

            // Defer diagram rendering to not block the tab switch
            if (target) setTimeout(function() { renderDiagrams(target); }, 50);
        }

        var _mermaidReady = false;
        var _renderQueue = Promise.resolve();

        function cleanupMermaidZombies() {
            // Remove any zombie containers Mermaid leaves in the body after rendering
            document.querySelectorAll('body > [id^="dmm-"]').forEach(function(z) { z.remove(); });
            // Also clean up any iframe or other elements Mermaid might create
            document.querySelectorAll('body > iframe[id*="mermaid"], body > svg[id*="mermaid"]').forEach(function(z) { z.remove(); });
        }

        function renderDiagrams(container) {
            if (!_mermaidReady) return;
            var pres = container.querySelectorAll('pre.mermaid[data-mcode]');
            if (pres.length === 0) return;
            pres.forEach(function(el) {
                el.innerHTML = '<div style="color:#64748b;padding:40px;text-align:center;">&#9203; –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã...</div>';
            });
            pres.forEach(function(el) {
                _renderQueue = _renderQueue.then(function() {
                    var code = el.getAttribute('data-mcode');
                    if (!code) return;
                    var id = 'mm-' + Math.random().toString(36).slice(2, 8);
                    return mermaid.render(id, code).then(function(result) {
                        el.innerHTML = result.svg;
                        el.removeAttribute('data-mcode');
                        cleanupMermaidZombies();
                    }).catch(function(err) {
                        el.innerHTML = '<div style="color:#e53e3e;padding:20px;text-align:center;">&#9888; –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞</div>';
                        el.removeAttribute('data-mcode');
                        cleanupMermaidZombies();
                    });
                });
            });
        }
    </script>
</head>
<body>

<div class="header">
            <h1>üè¢ Data Flow Diagram</h1>
    <p>Office Management System ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>
</div>

<div class="nav" id="nav">
    <button onclick="showTab('level0',this)" class="active">Level 0</button>
    <button onclick="showTab('level1',this)">Level 1</button>
    <button onclick="showTab('auth-api',this)">Auth API</button>
    <button onclick="showTab('build-api',this)">Building API</button>
    <button onclick="showTab('book-api',this)">Booking API</button>
    <button onclick="showTab('auth-flow',this)">Auth Flow</button>
    <button onclick="showTab('booking-flow',this)">Booking Flow</button>
    <button onclick="showTab('building-flow',this)">Building Flow</button>
    <button onclick="showTab('database',this)">Database</button>
    <button onclick="showTab('info',this)">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
</div>
        
        <div class="content">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LEVEL 0 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="level0" class="section active">
                <h2>–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ (Level 0)</h2>
    <p>–í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ –≤–Ω–µ—à–Ω–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.</p>

    <div class="diagram-card">
        <pre class="mermaid">
graph LR
    User["üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å&#10;(Browser)"]
    System["üè¢ Office Management&#10;System"]
    WBTeam["üîê team.wb.ru&#10;External Auth"]

    User -- "HTTP Requests" --> System
    System -- "HTTP Responses" --> User
    System -- "Auth Requests" --> WBTeam
    WBTeam -- "User Info + Token" --> System
    
    style System fill:#4A90E2,stroke:#2E5C8A,stroke-width:3px,color:#fff
    style User fill:#50C878,stroke:#2D7A4F,stroke-width:2px,color:#fff
    style WBTeam fill:#FF6B6B,stroke:#C92A2A,stroke-width:2px,color:#fff
        </pre>
                </div>
                
    <div class="info">
        <h4>–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏</h4>
        <ul>
            <li><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (Browser)</strong> ‚Äî –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å SPA –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π</li>
            <li><strong>Office Management System</strong> ‚Äî Frontend + Backend + Database</li>
            <li><strong>team.wb.ru API</strong> ‚Äî –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Wildberries</li>
                    </ul>
                </div>
            </div>
            
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LEVEL 1 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="level1" class="section">
                <h2>–î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ (Level 1)</h2>
    <p>–û—Å–Ω–æ–≤–Ω—ã–µ —Å–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –Ω–∏–º–∏.</p>
                
    <div class="diagram-card">
        <pre class="mermaid">
graph LR
    Browser["üñ•Ô∏è Browser&#10;SPA"]
    Nginx["üåê Nginx&#10;Static + Proxy"]
    API["‚öôÔ∏è Go API&#10;REST Server"]
    Auth["üîë Auth Module&#10;JWT Handler"]
    DB[("üíæ PostgreSQL")]
    FS["üìÅ File Storage&#10;uploads/buildings/"]
    WB["üîê team.wb.ru&#10;External Auth"]

    Browser -- "HTTP/HTTPS" --> Nginx
    Nginx -- "Static files" --> Browser
    Nginx -- "Proxy /api/*" --> API
    API -- "JSON" --> Nginx
    API -- "SQL Queries" --> DB
    DB -- "Result Sets" --> API
    API -- "Read / Write" --> FS
    API -- "Validate JWT" --> Auth
    Auth -- "Claims" --> API
    Auth -- "Verify Token" --> WB
    WB -- "User Info" --> Auth

    style Browser fill:#E8F4F8,stroke:#4A90E2,stroke-width:2px
    style Nginx fill:#FFF4E6,stroke:#FD7E14,stroke-width:2px
    style API fill:#E6F7FF,stroke:#1890FF,stroke-width:2px
    style Auth fill:#FFF7E6,stroke:#FA8C16,stroke-width:2px
    style DB fill:#F0F5FF,stroke:#597EF7,stroke-width:2px
    style FS fill:#F6FFED,stroke:#52C41A,stroke-width:2px
    style WB fill:#FFF1F0,stroke:#FF4D4F,stroke-width:2px
        </pre>
                </div>
                
                <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="background:#E8F4F8"></div>Client</div>
        <div class="legend-item"><div class="legend-dot" style="background:#FFF4E6"></div>Web Server</div>
        <div class="legend-item"><div class="legend-dot" style="background:#E6F7FF"></div>Application</div>
        <div class="legend-item"><div class="legend-dot" style="background:#FFF7E6"></div>Auth</div>
        <div class="legend-item"><div class="legend-dot" style="background:#F0F5FF"></div>Data Layer</div>
        <div class="legend-item"><div class="legend-dot" style="background:#F6FFED"></div>File Storage</div>
        <div class="legend-item"><div class="legend-dot" style="background:#FFF1F0"></div>External</div>
                </div>
            </div>
            
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH API ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="auth-api" class="section">
    <h2>Level 2 ‚Äî Auth Endpoints</h2>
    <p>–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∏—Ö —Å–≤—è–∑–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ –ë–î.</p>

    <div class="diagram-card">
        <pre class="mermaid">
graph LR
    subgraph Client
        JS["üé® Frontend JS"]
    end

    subgraph Auth["Auth Endpoints"]
        Code["/api/auth/v2/code/wb-captcha&#10;POST"]
        Confirm["/api/auth/v2/auth&#10;POST"]
        UserInfo["/api/auth/user/info&#10;GET"]
        WbBand["/api/auth/user/wb-band&#10;GET"]
        OToken["/api/auth/office-token&#10;POST"]
        Refr["/api/auth/refresh&#10;POST"]
    end

    subgraph Ext["External"]
        AuthHR["auth-hrtech.wb.ru"]
        TeamWB["team.wb.ru"]
    end

    subgraph Data
        JWT["üîë JWT Handler"]
        DB[("üíæ PostgreSQL&#10;users &#8226; refresh_tokens")]
    end

    JS -- "phone + captcha" --> Code
    Code -- "proxy" --> AuthHR

    JS -- "code" --> Confirm
    Confirm -- "proxy" --> AuthHR

    JS -- "Bearer token" --> UserInfo
    UserInfo -- "proxy" --> TeamWB
    UserInfo -- "upsert" --> DB

    JS -- "Bearer token" --> WbBand
    WbBand -- "proxy" --> TeamWB
    WbBand -- "upsert" --> DB

    JS -- "Bearer token" --> OToken
    OToken -- "verify" --> TeamWB
    OToken -- "sign" --> JWT
    JWT -- "store refresh" --> DB
    OToken -- "tokens" --> JS

    JS -- "refresh token" --> Refr
    Refr -- "validate" --> DB
    Refr -- "sign new" --> JWT
    Refr -- "tokens" --> JS

    style Client fill:#FFF4E6,stroke:#FD7E14,stroke-width:2px
    style Auth fill:#FFF7E6,stroke:#FA8C16,stroke-width:2px
    style Ext fill:#FFF1F0,stroke:#FF4D4F,stroke-width:2px
    style Data fill:#F0F5FF,stroke:#597EF7,stroke-width:2px
        </pre>
    </div>

    <div class="info">
        <h4>–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h4>
        <ul>
            <li><strong>Authorization Token</strong> ‚Äî –≤–Ω–µ—à–Ω–∏–π —Ç–æ–∫–µ–Ω –æ—Ç auth-hrtech.wb.ru</li>
            <li><strong>Office-Access-Token</strong> ‚Äî JWT (HS256, TTL 1 —á–∞—Å) —Å —Ä–æ–ª—è–º–∏ –∏ responsibilities</li>
            <li><strong>Office-Refresh-Token</strong> ‚Äî JWT (TTL 30 –¥–Ω–µ–π) —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏</li>
        </ul>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BUILD API ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="build-api" class="section">
    <h2>Level 2 ‚Äî Building &amp; Space Endpoints</h2>
    <p>CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∑–¥–∞–Ω–∏–π, —ç—Ç–∞–∂–µ–π, –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤, —Å—Ç–æ–ª–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω—ã—Ö.</p>

    <div class="diagram-card">
        <pre class="mermaid">
graph LR
    subgraph Client
        JS["üé® Frontend JS"]
    end

    subgraph API["Building Endpoints"]
        Build["/api/buildings&#10;GET / POST"]
        Floor["/api/floors&#10;GET / POST / PUT / DELETE"]
        Space["/api/spaces&#10;GET / POST / PUT / DELETE"]
        Desk["/api/desks&#10;GET / POST / PUT / DELETE"]
        Bulk["/api/desks/bulk&#10;POST batch"]
        MR["/api/meeting-rooms&#10;GET / POST / PUT / DELETE"]
    end

    subgraph Data
        DB[("üíæ PostgreSQL")]
        FS["üìÅ uploads/buildings/"]
    end

    JS --> Build
    JS --> Floor
    JS --> Space
    JS --> Desk
    JS --> Bulk
    JS --> MR

    Build -- "office_buildings" --> DB
    Build -- "image" --> FS
    Floor -- "floors" --> DB
    Space -- "coworkings" --> DB
    Desk -- "workplaces" --> DB
    Bulk -- "workplaces batch" --> DB
    MR -- "meeting_rooms" --> DB

    style Client fill:#FFF4E6,stroke:#FD7E14,stroke-width:2px
    style API fill:#E6FFFB,stroke:#13C2C2,stroke-width:2px
    style Data fill:#F0F5FF,stroke:#597EF7,stroke-width:2px
        </pre>
    </div>

    <div class="info">
        <h4>–ò–µ—Ä–∞—Ä—Ö–∏—è –æ–±—ä–µ–∫—Ç–æ–≤</h4>
        <ul>
            <li><strong>Building</strong> ‚Üí –∑–¥–∞–Ω–∏–µ —Å –∞–¥—Ä–µ—Å–æ–º, timezone, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º</li>
            <li><strong>Floor</strong> ‚Üí —ç—Ç–∞–∂ –∑–¥–∞–Ω–∏—è —Å SVG-–ø–ª–∞–Ω–æ–º</li>
            <li><strong>Space (Coworking)</strong> ‚Üí –∑–æ–Ω–∞ –Ω–∞ —ç—Ç–∞–∂–µ —Å –ø–æ–ª–∏–≥–æ–Ω–∞–ª—å–Ω–æ–π –≥—Ä–∞–Ω–∏—Ü–µ–π</li>
            <li><strong>Workplace (Desk)</strong> ‚Üí —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏</li>
            <li><strong>Meeting Room</strong> ‚Üí –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ –Ω–∞ —ç—Ç–∞–∂–µ</li>
        </ul>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BOOK API ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="book-api" class="section">
    <h2>Level 2 ‚Äî Booking &amp; User Endpoints</h2>
    <p>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∑–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.</p>

    <div class="diagram-card">
        <pre class="mermaid">
graph LR
    subgraph Client
        JS["üé® Frontend JS"]
    end

    subgraph BookAPI["Booking Endpoints"]
        Book["/api/bookings&#10;GET / POST"]
        BookDel["/api/bookings/:id&#10;DELETE"]
        MRBook["/api/meeting-room-bookings&#10;GET / POST"]
        MRDel["/api/meeting-room-bookings/:id&#10;DELETE"]
    end

    subgraph UserAPI["User Endpoints"]
        Users["/api/users&#10;GET"]
        Role["/api/users/role&#10;PUT"]
        Resp["/api/responsibilities&#10;GET"]
    end

    subgraph Data
        DB[("üíæ PostgreSQL")]
    end

    JS --> Book
    JS --> BookDel
    JS --> MRBook
    JS --> MRDel
    JS --> Users
    JS --> Role
    JS --> Resp

    Book -- "workplace_bookings" --> DB
    BookDel -- "cancelled_at" --> DB
    MRBook -- "meeting_room_bookings" --> DB
    MRDel -- "cancelled_at" --> DB
    Users -- "users" --> DB
    Role -- "users.role" --> DB
    Resp -- "buildings / floors / coworkings" --> DB

    style Client fill:#FFF4E6,stroke:#FD7E14,stroke-width:2px
    style BookAPI fill:#F9F0FF,stroke:#722ED1,stroke-width:2px
    style UserAPI fill:#FFF0F6,stroke:#EB2F96,stroke-width:2px
    style Data fill:#F0F5FF,stroke:#597EF7,stroke-width:2px
        </pre>
                    </div>

    <div class="info">
        <h4>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
        <ul>
            <li><strong>Soft Delete</strong> ‚Äî –±—Ä–æ–Ω–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è, –∞ –ø–æ–º–µ—á–∞—é—Ç—Å—è cancelled_at</li>
            <li><strong>Unique Constraint</strong> ‚Äî –æ–¥–Ω–æ —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ = –æ–¥–Ω–∞ –±—Ä–æ–Ω—å –Ω–∞ –¥–∞—Ç—É</li>
            <li><strong>Tenant vs Applier</strong> ‚Äî –±—Ä–æ–Ω—å –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</li>
            <li><strong>Timezone Aware</strong> ‚Äî —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è timezone –∑–¥–∞–Ω–∏—è</li>
        </ul>
                </div>
            </div>
            
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH FLOW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="auth-flow" class="section">
    <h2>–°—Ü–µ–Ω–∞—Ä–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h2>
    <p>–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –æ—Ç –≤–≤–æ–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ —Ä–∞–±–æ—Ç—ã —Å –∑–∞—â–∏—â—ë–Ω–Ω—ã–º–∏ API.</p>

    <div class="diagram-card">
        <pre class="mermaid">
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant A as API Server
    participant W as team.wb.ru
    participant DB as PostgreSQL
    participant J as JWT Handler

    Note over U,J: –®–∞–≥ 1 ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ Authorization Token
    U->>F: –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    F->>U: –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
    U->>F: –í–≤–µ—Å—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω
    F->>A: POST /api/auth/v2/code/wb-captcha
    A->>W: –ó–∞–ø—Ä–æ—Å –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    W-->>A: –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
    A-->>F: success true
    F->>U: –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–µ –¥–ª—è –∫–æ–¥–∞
    U->>F: –í–≤–µ—Å—Ç–∏ –∫–æ–¥
    F->>A: POST /api/auth/v2/auth
    A->>W: –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥
    W-->>A: Authorization Token
    A-->>F: authorization_token
    
    Note over U,J: –®–∞–≥ 2 ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ Office Access Token
    F->>A: POST /api/auth/office-token
    A->>W: GET /api/v1/user/info
    W-->>A: User Info (employee_id, name)
    A->>DB: Upsert user
    A->>DB: –ü–æ–ª—É—á–∏—Ç—å —Ä–æ–ª—å + responsibilities
    DB-->>A: role, building_ids, floor_ids
    A->>J: –°–æ–∑–¥–∞—Ç—å Office JWT
    J->>DB: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å refresh token
    J-->>A: access + refresh tokens
    A-->>F: –¢–æ–∫–µ–Ω—ã
    F->>F: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
    
    Note over U,J: –®–∞–≥ 3 ‚Äî –†–∞–±–æ—Ç–∞ —Å API
    U->>F: –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–¥–∞–Ω–∏–π
    F->>A: GET /api/buildings
    A->>J: –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å Office-Access-Token
    J-->>A: Valid, claims
    A->>DB: SELECT FROM office_buildings
    DB-->>A: Buildings data
    A-->>F: JSON response
    F->>U: –ü–æ–∫–∞–∑–∞—Ç—å –∑–¥–∞–Ω–∏—è
    
    Note over U,J: –®–∞–≥ 4 ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (Rotation)
    F->>F: –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫
    F->>A: POST /api/auth/refresh
    A->>DB: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å refresh token
    DB-->>A: Valid, not revoked
    A->>DB: Revoke old refresh token
    A->>J: –ù–æ–≤—ã–π access + refresh JWT
    J->>DB: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π refresh token
    J-->>A: new tokens
    A-->>F: –ù–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã
    F->>F: –û–±–Ω–æ–≤–∏—Ç—å localStorage
        </pre>
                    </div>
                </div>
                
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BOOKING FLOW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="booking-flow" class="section">
    <h2>–°—Ü–µ–Ω–∞—Ä–∏–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
    <p>–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç, —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.</p>

    <div class="diagram-card">
        <pre class="mermaid">
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant A as API Server
    participant DB as PostgreSQL
    
    Note over U,DB: –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç
    U->>F: –í—ã–±—Ä–∞—Ç—å –∑–¥–∞–Ω–∏–µ –∏ —ç—Ç–∞–∂
    F->>A: GET /api/spaces?floor_id=X
    A->>DB: SELECT coworkings WHERE floor_id
    DB-->>A: Spaces data
    A-->>F: JSON
    F->>A: GET /api/desks?space_id=Y&date=2026-02-14
    A->>DB: SELECT workplaces LEFT JOIN bookings
    DB-->>A: Desks + booking status
    A-->>F: Desks with booking info
    F->>U: –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞–Ω —ç—Ç–∞–∂–∞
    
    Note over U,DB: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    U->>F: –í—ã–±—Ä–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–æ–ª
    U->>F: –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω—å
    F->>A: POST /api/bookings
    A->>A: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –∏–∑ JWT
    A->>DB: INSERT INTO workplace_bookings
    DB-->>A: Booking created
    A-->>F: booking_id
    F->>U: –ë—Ä–æ–Ω—å —Å–æ–∑–¥–∞–Ω–∞
    
    Note over U,DB: –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    U->>F: –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å
    F->>A: DELETE /api/bookings/ID
    A->>A: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
    A->>DB: UPDATE cancelled_at = NOW()
    DB-->>A: OK
    A-->>F: Success
    F->>U: –ë—Ä–æ–Ω—å –æ—Ç–º–µ–Ω–µ–Ω–∞
        </pre>
                    </div>
                </div>
                
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BUILDING FLOW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="building-flow" class="section">
    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–¥–∞–Ω–∏—è–º–∏</h2>
    <p>–°–æ–∑–¥–∞–Ω–∏–µ –∑–¥–∞–Ω–∏–π, —ç—Ç–∞–∂–µ–π, –∑–æ–Ω –∏ —Ä–∞–±–æ—á–∏—Ö –º–µ—Å—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.</p>

    <div class="diagram-card">
        <pre class="mermaid">
sequenceDiagram
    participant A as Admin
    participant F as Frontend
    participant API as API Server
    participant JWT as JWT Handler
    participant DB as PostgreSQL
    participant FS as File Storage
    
    Note over A,FS: –°–æ–∑–¥–∞–Ω–∏–µ –∑–¥–∞–Ω–∏—è
    A->>F: –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É
    F->>API: POST /api/buildings (multipart)
    API->>JWT: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª—å
    JWT-->>API: Role = Admin
    API->>FS: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    FS-->>API: /uploads/buildings/123.png
    API->>DB: INSERT INTO office_buildings
    DB-->>API: Building ID
    API-->>F: building_id + image_url
    
    Note over A,FS: –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ç–∞–∂–∞
    A->>F: –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–∂
    F->>API: POST /api/floors
    API->>JWT: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å responsibility
    JWT-->>API: Has responsibility
    API->>DB: INSERT INTO floors
    DB-->>API: Floor ID
    API-->>F: floor_id

    Note over A,FS: –°–æ–∑–¥–∞–Ω–∏–µ –∑–æ–Ω—ã (–∫–æ–≤–æ—Ä–∫–∏–Ω–≥)
    A->>F: –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∑–æ–Ω—É
    F->>API: POST /api/spaces
    API->>JWT: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å responsibility
    API->>DB: INSERT INTO coworkings
    DB-->>API: Space ID
    API-->>F: space_id

    Note over A,FS: –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–æ–≤
    A->>F: –†–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å—Ç–æ–ª—ã
    F->>API: POST /api/desks/bulk
    API->>JWT: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å responsibility
    API->>DB: INSERT INTO workplaces (batch)
    DB-->>API: Desk IDs
    API-->>F: desk_ids
        </pre>
                    </div>
                </div>
                
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATABASE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="database" class="section">
    <h2>–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h2>
    <p>ER-–¥–∏–∞–≥—Ä–∞–º–º–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∏ –∏—Ö —Å–≤—è–∑–µ–π.</p>

    <div class="diagram-card">
        <pre class="mermaid">
erDiagram
    users ||--o{ workplace_bookings : "books"
    users ||--o{ meeting_room_bookings : "books"
    users ||--o{ office_refresh_tokens : "has"
    office_buildings ||--|{ floors : "contains"
    floors ||--|{ coworkings : "contains"
    floors ||--|{ meeting_rooms : "contains"
    coworkings ||--|{ workplaces : "contains"
    workplaces ||--o{ workplace_bookings : "booked_as"
    meeting_rooms ||--o{ meeting_room_bookings : "booked_as"
    
    users {
        bigint id PK
        text full_name
        text employee_id UK
        text wb_team_profile_id
        text wb_user_id UK
        text avatar_url
        text wb_band
        int role
        timestamptz created_at
    }
    
    office_buildings {
        bigint id PK
        text name
        text address
        text timezone
        text image_url
        text responsible_employee_id
        text floors_json
        timestamptz created_at
    }
    
    floors {
        bigint id PK
        bigint building_id FK
        text name
        int level
        text plan_svg
        text responsible_employee_id
        timestamptz created_at
    }
    
    coworkings {
        bigint id PK
        bigint floor_id FK
        text name
        text subdivision_level_1
        text subdivision_level_2
        text responsible_employee_id
        text points_json
        text color
        int snapshot_hidden
        timestamptz created_at
    }
    
    workplaces {
        bigint id PK
        bigint coworking_id FK
        text label
        float x
        float y
        float width
        float height
        float rotation
        timestamptz created_at
    }
    
    workplace_bookings {
        bigint id PK
        bigint workplace_id FK
        text applier_employee_id
        text tenant_employee_id
        text date
        timestamptz cancelled_at
        text canceller_employee_id
        timestamptz created_at
    }

    meeting_rooms {
        bigint id PK
        bigint floor_id FK
        text name
        int capacity
        text points_json
        text color
        timestamptz created_at
    }
    
    meeting_room_bookings {
        bigint id PK
        bigint meeting_room_id FK
        text applier_employee_id
        timestamptz start_at
        timestamptz end_at
        timestamptz cancelled_at
        text canceller_employee_id
        timestamptz created_at
    }
    
    office_refresh_tokens {
        bigint id PK
        text token_id UK
        text employee_id
        timestamptz expires_at
        timestamptz revoked_at
        timestamptz created_at
    }
        </pre>
                </div>
                
    <div class="info">
                    <h4>–ö–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã</h4>
                    <ul>
            <li><strong>users</strong> ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—è–º–∏ (1=Employee, 2=Admin)</li>
            <li><strong>office_buildings</strong> ‚Üí <strong>floors</strong> ‚Üí <strong>coworkings</strong> ‚Üí <strong>workplaces</strong> ‚Äî –∏–µ—Ä–∞—Ä—Ö–∏—è –æ–±—ä–µ–∫—Ç–æ–≤</li>
            <li><strong>meeting_rooms</strong> ‚Äî –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã –Ω–∞ —ç—Ç–∞–∂–∞—Ö</li>
            <li><strong>workplace_bookings</strong> ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–æ–ª–æ–≤ (UNIQUE workplace_id + date)</li>
            <li><strong>meeting_room_bookings</strong> ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω—ã—Ö (start_at / end_at)</li>
            <li><strong>office_refresh_tokens</strong> ‚Äî refresh-—Ç–æ–∫–µ–Ω—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–∏ (revoked_at)</li>
                    </ul>
                </div>
            </div>
            
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INFO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="info" class="section">
                <h2>–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h2>
                
    <h3 style="margin:20px 0 12px;color:var(--accent)">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫</h3>
    <div class="tech-grid">
        <div class="tech-card"><h4>üé® Frontend</h4><p>Vanilla JS, HTML5, CSS3, Vite. SPA –±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤.</p></div>
        <div class="tech-card"><h4>üîß Backend</h4><p>Go 1.21+, net/http, pgx. REST API —Å middleware.</p></div>
        <div class="tech-card"><h4>üíæ Database</h4><p>PostgreSQL 16 Alpine. JSON-–ø–æ–ª—è, –∏–Ω–¥–µ–∫—Å—ã, constraints.</p></div>
        <div class="tech-card"><h4>üîê Auth</h4><p>JWT HS256. –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã. team.wb.ru API.</p></div>
        <div class="tech-card"><h4>üåê Web Server</h4><p>Nginx (prod) —Å reverse proxy. Go FileServer (dev).</p></div>
        <div class="tech-card"><h4>üê≥ Deploy</h4><p>Docker + Docker Compose. Multi-stage builds.</p></div>
                    </div>
                    
    <h3 style="margin:28px 0 12px;color:var(--accent)">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
    <div class="info">
        <ul>
            <li><strong>–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</strong> ‚Äî Authorization Token (team.wb.ru) + Office JWT</li>
            <li><strong>Middleware</strong> ‚Äî CORS, Security Headers, Logging, JWT Validation</li>
            <li><strong>–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞</strong> ‚Äî —Ä–æ–ª–∏ + responsibilities –≤ JWT</li>
            <li><strong>Rate Limiting</strong> ‚Äî 10 req/min –Ω–∞ auth endpoints</li>
            <li><strong>SQL Injection</strong> ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (pgx)</li>
            <li><strong>HTTPS</strong> ‚Äî –≤ production, HSTS header</li>
            <li><strong>MaxBytesReader</strong> ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–≥—Ä—É–∑–æ–∫ (5 MB)</li>
                    </ul>
                </div>
                
    <h3 style="margin:28px 0 12px;color:var(--accent)">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è</h3>
    <div class="info">
        <ul>
            <li><strong>Stateless API</strong> ‚Äî –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ JWT</li>
            <li><strong>Graceful Shutdown</strong> ‚Äî SIGTERM / SIGINT</li>
            <li><strong>Health Check</strong> ‚Äî GET /api/health</li>
            <li><strong>Auto Migrations</strong> ‚Äî –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞</li>
            <li><strong>Connection Pooling</strong> ‚Äî –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π PostgreSQL</li>
            <li><strong>Timezone Support</strong> ‚Äî timezone per building</li>
            <li><strong>Soft Delete</strong> ‚Äî cancelled_at –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è</li>
            <li><strong>Token Rotation</strong> ‚Äî —Ä–æ—Ç–∞—Ü–∏—è refresh token –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏</li>
                    </ul>
            </div>
        </div>

</div><!-- /content -->
        
        <footer>
    <strong>Office Management System ‚Äî Data Flow Diagram</strong><br>
    –°–æ–∑–¥–∞–Ω–æ: 2026-02-13 &nbsp;|&nbsp; –û–±–Ω–æ–≤–ª–µ–Ω–æ: 2026-02-15 &nbsp;|&nbsp; –í–µ—Ä—Å–∏—è 2.0
        </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: { useMaxWidth: true, htmlLabels: true, curve: 'basis', padding: 20, nodeSpacing: 50, rankSpacing: 60 },
            sequence: { diagramMarginX: 30, diagramMarginY: 10, actorMargin: 60, width: 180, height: 55, boxMargin: 10, boxTextMargin: 5, noteMargin: 10, messageMargin: 40, mirrorActors: true, useMaxWidth: true },
            er: { useMaxWidth: true, layoutDirection: 'TB' }
        });

        // Move mermaid source from textContent to data attribute so it won't be processed twice
        document.querySelectorAll('pre.mermaid').forEach(function(el) {
            el.setAttribute('data-mcode', el.textContent.trim());
            el.textContent = '';
        });

        _mermaidReady = true;

        // Render the initial active section
        var initialSection = document.querySelector('.section.active');
        if (initialSection) renderDiagrams(initialSection);
    </script>

</body>
</html>
